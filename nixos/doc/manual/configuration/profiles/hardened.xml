<section xmlns="http://docbook.org/ns/docbook"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         version="5.0"
         xml:id="sec-profile-hardened">
 <title>Hardened</title>
 <para>
  A profile with most (vanilla) hardening options enabled by default,
  potentially at the cost of features and performance.  The user is expected to
  relax these defaults where necessary, to best fit their deployment.
 </para>
 <para>
  An important caveat is that enabling the hardened profile may not
  materially improve the security of the system.  For one, mitigations enabled
  by the profile may be speculative or yet to be proven effective.  Secondly,
  the mitigations themselves may have (exploitable) bugs or trigger problematic
  codepaths in other parts of the system.  It is up to the administrator to
  judge whether a given hardening feature provides a reasonable
  security/usability tradeoff.  Some of the features enabled here are off by
  default for a reason.
 </para>
 <para>
  The hardened profile:
  <itemizedlist>
   <listitem>Enables kernel module locking</listitem>
   <listitem>Enables process information hiding</listitem>
   <listitem>Enables page poisoning</listitem>
   <listitem>Disabling exotic network protocols</listitem>
   <listitem>Makes it harder to replace the running kernel image</listitem>
   <listitem>Restricts access to dmesg(8)</listitem>
   <listitem>Disables user namespaces</listitem>
   <listitem>Enables various virtual memory hardening</listitem>
  </itemizedlist>
  See the <literal xlink:href="https://github.com/nixos/nixpkgs/tree/master/nixos/modules/profiles/hardened.nix"> profile source</literal> for further detail on which settings are altered.
 </para>
 <para>
  Below is a (non-exhaustive) list of features/options known to be
  incompatible with the hardened defaults.
  <itemizedlist>
   <listitem>
    <para>
     <xref linkend="opt-nix.useSandbox"/> relies on user namespaces,
     which are disabled by the hardened profile.  To relax this
     restriction, set <xref linkend="opt-security.allowUserNamespaces"/>.
     Beware, however, that user namespaces have been implicated in privilege
     escalation bugs.
     </para>
   </listitem>
   <listitem>
    <para>
     Hibernation.  There is no easy work-around for this.
    </para>
   </listitem>
  </itemizedlist>
 </para>
</section>
